<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Board Game Timer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- PWA / Fullscreen -->
<meta name="theme-color" content="#111" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<link rel="manifest" href="manifest.webmanifest" />

<style>
  html, body { margin: 0; height: 100%; font-family: Arial, sans-serif; }

  .screen {
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    height: 100%; background: #222; color: #fff; position: relative;
  }

  .btn {
    font-size: 22px; padding: 15px 30px; margin: 10px;
    border: none; border-radius: 14px; background: #444; color: #fff;
  }

  .backBtn {
    position: absolute; top: 16px; left: 16px;
    font-size: 18px; padding: 10px 18px; border-radius: 12px;
    border: none; background: rgba(0,0,0,.6); color: #fff;
  }

  #game { display: none; height: 100%; position: relative; }
  .grid { display: grid; height: 100%; }

  .player {
    display: flex; align-items: center; justify-content: center;
    font-size: 2.4em; user-select: none; -webkit-tap-highlight-color: transparent;
    opacity: .4;
  }
  .active { opacity: 1; font-weight: bold; }

  .topbar {
    position: absolute; top: 12px; left: 12px; right: 12px;
    z-index: 10; display: flex; justify-content: space-between; align-items: center;
    pointer-events: none;
  }
  .group { display: flex; gap: 14px; pointer-events: auto; }

  .controlBtn {
    font-size: 20px; padding: 14px 20px; border-radius: 14px; border: none;
    background: rgba(0,0,0,.65); color: #fff;
  }

  .badge {
    min-width: 190px; font-size: 20px; padding: 14px 22px; border-radius: 16px;
    background: rgba(0,0,0,.4); display: flex; align-items: center; justify-content: center;
    gap: 14px; pointer-events: auto;
  }

  .paused { filter: brightness(.6); }

  .sub {
    margin-top: 10px;
    opacity: .8;
    font-size: 16px;
    text-align: center;
    max-width: 320px;
    line-height: 1.3;
  }
</style>
</head>

<body>

<!-- WELCOME -->
<div id="welcomeScreen" class="screen">
  <h1 style="font-size: 2.6em; text-align:center; margin: 0 20px;">Welcome Board Game Timer</h1>
  <div class="sub">2‚Äì7 ki≈üi ‚Ä¢ Tam ekran ‚Ä¢ Mola ‚Ä¢ Round ‚Ä¢ Taslak y√∂n oku</div>
  <button class="btn" onclick="closeWelcome()">Start</button>
</div>

<!-- PLAYER SELECT -->
<div id="playerScreen" class="screen" style="display:none;">
  <h1>Ka√ß ki≈üisiniz?</h1>
  <button class="btn" onclick="setPlayers(2)">2 Ki≈üi</button>
  <button class="btn" onclick="setPlayers(3)">3 Ki≈üi</button>
  <button class="btn" onclick="setPlayers(4)">4 Ki≈üi</button>
  <button class="btn" onclick="setPlayers(5)">5 Ki≈üi</button>
  <button class="btn" onclick="setPlayers(6)">6 Ki≈üi</button>
  <button class="btn" onclick="setPlayers(7)">7 Ki≈üi</button>
</div>

<!-- TIME SELECT -->
<div id="timeScreen" class="screen" style="display:none;">
  <button class="backBtn" onclick="goToPlayers()">‚¨Ö BACK</button>
  <h1>S√ºreyi se√ßin</h1>
  <button class="btn" onclick="startGame(60)">1 Dakika</button>
  <button class="btn" onclick="startGame(300)">5 Dakika</button>
  <button class="btn" onclick="startGame(1200)">20 Dakika</button>
  <button class="btn" onclick="startGame(1800)">30 Dakika</button>
  <button class="btn" onclick="startGame(2700)">45 Dakika</button>
</div>

<!-- GAME -->
<div id="game">
  <div class="topbar">
    <div class="group">
      <button class="controlBtn" onclick="goToTime()">‚¨Ö BACK</button>
      <button class="controlBtn" id="pauseBtn" onclick="togglePause()">‚è∏ Mola</button>
      <button class="controlBtn" onclick="nextRound()">üîÅ Round</button>
    </div>

    <div class="badge">
      <span id="arrow">‚¨ÖÔ∏è</span>
      <span id="roundText">Round 1</span>
    </div>
  </div>

  <div id="grid" class="grid"></div>
</div>

<script>
  // Offline (Service Worker)
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./sw.js");
  }

  // Renkler: alfabetik (TR) -> Beyaz, Kƒ±rmƒ±zƒ±, Mavi, Sarƒ±, Siyah, Turuncu, Ye≈üil
  // Pastel tonlar (beyaz/siyah hari√ß)
  const palette = [
    { name: "Beyaz",   bg: "#F7F7F7" },
    { name: "Kƒ±rmƒ±zƒ±", bg: "#F4A7A7" },
    { name: "Mavi",    bg: "#A7C7F4" },
    { name: "Sarƒ±",    bg: "#F4E7A7" },
    { name: "Siyah",   bg: "#1C1C1C" },
    { name: "Turuncu", bg: "#F4C7A7" },
    { name: "Ye≈üil",   bg: "#A7F4C7" },
  ];

  let players = 0, times = [], current = 0, paused = false;
  let round = 1, arrowLeft = true;

  function closeWelcome() {
    document.getElementById("welcomeScreen").style.display = "none";
    document.getElementById("playerScreen").style.display = "flex";
  }

  function setPlayers(c) {
    players = c;
    playerScreen.style.display = "none";
    timeScreen.style.display = "flex";
  }

  function goToPlayers() {
    timeScreen.style.display = "none";
    playerScreen.style.display = "flex";
  }

  function goToTime() {
    game.style.display = "none";
    paused = false;
    pauseBtn.textContent = "‚è∏ Mola";
    timeScreen.style.display = "flex";
    disableWakeLock();
  }

  function startGame(sec) {
    times = Array(players).fill(sec);
    current = 0;
    round = 1;
    arrowLeft = true;
    updateRoundUI();

    timeScreen.style.display = "none";
    game.style.display = "block";

    buildGrid();
    render();
    enableWakeLock();
  }

  function buildGrid() {
    grid.innerHTML = "";

    // 2-4: 2x2, 5-6: 3x2, 7: 4x2 (son h√ºcre bo≈ü kalabilir)
    // Basit, okunaklƒ± bir yerle≈üim:
    let cols = 2;
    if (players >= 5 && players <= 6) cols = 3;
    if (players === 7) cols = 4;

    const rows = Math.ceil(players / cols);

    grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
    grid.style.gridTemplateRows = `repeat(${rows}, 1fr)`;

    for (let i = 0; i < players; i++) {
      const d = document.createElement("div");
      d.className = "player";
      d.id = "p" + i;

      const bg = palette[i].bg;
      d.style.background = bg;
      d.style.color = bestTextColor(bg);

      d.onclick = () => tap(i);
      grid.appendChild(d);
    }
  }

  function bestTextColor(hex) {
    // #RRGGBB -> luminance
    const c = hex.replace("#", "");
    const r = parseInt(c.slice(0,2), 16) / 255;
    const g = parseInt(c.slice(2,4), 16) / 255;
    const b = parseInt(c.slice(4,6), 16) / 255;

    // relative luminance approx
    const lum = 0.2126*r + 0.7152*g + 0.0722*b;
    return lum > 0.6 ? "#111" : "#FFF";
  }

  function format(t) {
    return Math.floor(t / 60) + ":" + String(t % 60).padStart(2, "0");
  }

  function render() {
    for (let i = 0; i < players; i++) {
      const e = document.getElementById("p" + i);
      e.textContent = format(times[i]);
      e.classList.toggle("active", i === current);
    }
  }

  setInterval(() => {
    if (!paused && players > 0 && times[current] > 0) {
      times[current]--;
      render();
    }
  }, 1000);

  function tap(i) {
    if (!paused && i === current) {
      current = (current + 1) % players;
      render();
    }
  }

  function togglePause() {
    paused = !paused;
    pauseBtn.textContent = paused ? "‚ñ∂ Devam" : "‚è∏ Mola";
    grid.classList.toggle("paused", paused);
    if (paused) disableWakeLock(); else enableWakeLock();
  }

  function nextRound() {
    arrowLeft = !arrowLeft;
    round = (round % 20) + 1;
    updateRoundUI();
  }

  function updateRoundUI() {
    arrow.textContent = arrowLeft ? "‚¨ÖÔ∏è" : "‚û°Ô∏è";
    roundText.textContent = "Round " + round;
  }

  // Wake Lock (Android Chrome'da iyi √ßalƒ±≈üƒ±r)
  let wakeLock = null;
  async function enableWakeLock() {
    try {
      if ("wakeLock" in navigator) {
        wakeLock = await navigator.wakeLock.request("screen");
      }
    } catch (e) {}
  }
  async function disableWakeLock() {
    try {
      if (wakeLock) {
        await wakeLock.release();
        wakeLock = null;
      }
    } catch (e) {}
  }
  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible" && !paused) enableWakeLock();
  });
</script>

</body>
</html>
